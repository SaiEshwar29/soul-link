<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Student Mental Health Chatbot</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #0f1724;
    color: #e6eef8;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .chatbox {
    width: 90%;
    max-width: 800px;
    height: 90vh;
    display: flex;
    flex-direction: column;
    background: #111827;
    border-radius: 12px;
    overflow: hidden;
  }
  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }
  .msg {
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 10px;
    max-width: 70%;
    line-height: 1.4;
    word-wrap: break-word;
  }
  .user {
    background: #0ea5a6;
    color: #042023;
    margin-left: auto;
  }
  .assistant {
    background: #1e293b;
    color: #e6eef8;
    margin-right: auto;
  }
  .input-area {
    display: flex;
    padding: 10px;
    background: #0b1220;
  }
  .input-area input {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 8px;
    margin-right: 8px;
    background: #1f2937;
    color: white;
  }
  .input-area button {
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    background: #7c3aed;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>
<div class="chatbox">
  <div class="messages" id="messages"></div>
  <div class="input-area">
    <input id="userInput" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const API_KEY = "AIzaSyBpIHC8j2O0AxHvyqjpyUAy4EM3exh2REI";
const MODEL = "gemini-1.5-flash";
const messagesEl = document.getElementById("messages");
const inputEl = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

let history = [
  {
    role: "user",
    parts: [{
      text: "You are a supportive, compassionate assistant specializing in mental health and psychological support for students in higher education. Provide empathetic listening, study tips, stress management, short breathing exercises, and always encourage professional help if issues are serious."
    }]
  }
];

// Render message in UI
function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.textContent = text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

// Send user input
async function sendMessage() {
  const text = inputEl.value.trim();
  if (!text) return;
  inputEl.value = "";
  addMessage(text, "user");
  history.push({ role: "user", parts: [{ text }] });

  // Show assistant placeholder
  addMessage("...", "assistant");
  const placeholder = messagesEl.lastChild;

  try {
    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ contents: history })
      }
    );

    const data = await res.json();

    // Extract model reply
    let reply = "No response";
    if (data.candidates?.[0]?.content?.parts) {
      reply = data.candidates[0].content.parts.map(p => p.text).join("\n");
    }

    placeholder.textContent = reply;
    history.push({ role: "model", parts: [{ text: reply }] });
  } catch (e) {
    placeholder.textContent = "Error: " + e.message;
    console.error(e);
  }
}

// Event listeners
sendBtn.onclick = sendMessage;
inputEl.addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
